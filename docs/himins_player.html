<!DOCTYPE html>

<html>
<head>
  <title>himins_player.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="himins_app.html">
                himins_app.js
              </a>
            
              
              <a class="source" href="himins_commands.html">
                himins_commands.js
              </a>
            
              
              <a class="source" href="himins_file_utils.html">
                himins_file_utils.js
              </a>
            
              
              <a class="source" href="himins_format.html">
                himins_format.js
              </a>
            
              
              <a class="source" href="himins_game.html">
                himins_game.js
              </a>
            
              
              <a class="source" href="himins_player.html">
                himins_player.js
              </a>
            
              
              <a class="source" href="himins_repl.html">
                himins_repl.js
              </a>
            
              
              <a class="source" href="himins_room.html">
                himins_room.js
              </a>
            
              
              <a class="source" href="himins_string_utils.html">
                himins_string_utils.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>himins_player.js</h1>
<p>Manages a player object from a himins player JSON file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*jslint browser: false, continue: true, devel: true, indent: 2, maxerr: 50, newcap : true, nomen: true, plusplus: true, regexp: true, sloppy: true, vars: false, white: true
*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>includes</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>3rd party modules</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _ = require(<span class="string">'underscore'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>Himins modules</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  commands = require(<span class="string">'./himins_commands'</span>),
  game = require(<span class="string">'./himins_game'</span>),
  room = require(<span class="string">'./himins_room'</span>),
  player = require(<span class="string">'./himins_player'</span>),
  repl = require(<span class="string">'./himins_repl'</span>),
  format = require(<span class="string">'./himins_format'</span>),
  files = require(<span class="string">'./himins_file_utils'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2>module vars</h2>
<h1>init(playerObject)</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject)</span> {</span>
  console.log(<span class="string">'*** himins_player.js init('</span>, playerObject.name, <span class="string">')'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>if the player has any starter items in her inventory add their names as commands</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>   _.each(playerObject.inventory, <span class="function"><span class="keyword">function</span> <span class="params">(e, i, l)</span> {</span>
    commands.addCommand(playerObject.commands, { 
      name: e.name,
      description: e.description,
      action: e.action,
      kind: e.kind 
    });
  });
};
module.exports.init = init;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h1>addToInventory(playerObject, itemObject)</h1>
<p>Items are discovered in sections and added to player inventory.
Step 1: remove item from the section and the players command list. 
Step 2: add the item to the inventory and the players command list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> addToInventory = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, itemObject, sectionObject)</span> {</span>
  
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h1>getInventoryNames(playerObject)</h1>
<p>Returns a string with the names of the items in the player inventory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> getInventoryNames = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject)</span> {</span>
  <span class="keyword">var</span>
    resultString = <span class="string">''</span>,
    resultList = [];

  _.each(playerObject.inventory, <span class="function"><span class="keyword">function</span> <span class="params">(e, i, l)</span> {</span>
    resultList.push(<span class="string">'_'</span> + e.name + <span class="string">'_'</span>);
  });

  resultString = resultList.toString().replace(<span class="regexp">/,/g</span>, <span class="string">', '</span>);
  <span class="keyword">return</span> resultString;
};
module.exports.getInventoryNames = getInventoryNames;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h1>enterRoom(playerObject, roomObject)</h1>
<p>Call when a player first spawns or enters a room</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> enterRoom = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, roomObject)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>add commands for this room</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  playerObject.commands = commands.combineCommands(playerObject.commands, roomObject.commands);

  repl.writeToClient(playerObject.client, format.formatText(playerObject.client, roomObject.description, <span class="number">2</span>, <span class="number">78</span>));
};
module.exports.enterRoom = enterRoom;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h1>exitRoom(playerObject, roomObject)</h1>
<p>Call when a player finally despawns or leaves a room</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> exitRoom = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, roomObject)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>remove commands for this room</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  playerObject.commands = commands.removeCommandsByKind(playerObject.commands, <span class="string">'room'</span>);
};
module.exports.exitRoom = exitRoom;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h1>enterSection(playerObject, sectionObject)</h1>
<p>Call when a player first spawns or enters a section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> enterSection = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, sectionObject)</span> {</span>
  <span class="keyword">var</span>
    gameObject = playerObject.game,
    roomObject = game.getRoomByName(gameObject, playerObject.roomName);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>add commands for this section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  playerObject.commands = commands.combineCommands(playerObject.commands, sectionObject.commands);
  repl.writeToClient(playerObject.client, format.formatText(playerObject.client, sectionObject.description, <span class="number">2</span>, <span class="number">78</span>));
};
module.exports.enterSection = enterSection;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h1>exitSection(playerObject, sectionObject)</h1>
<p>Call when a player finally despawns or leaves a room</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> exitSection = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, sectionObject)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>remove commands for this section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  playerObject.commands = commands.removeCommandsByKind(playerObject.commands, <span class="string">'section'</span>);
};
module.exports.exitSection = exitSection;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h1>moveToSection(playerObject, action)</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> moveToSection = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, action)</span> {</span>
  <span class="keyword">var</span> gameObject = playerObject.game,
      roomObject = game.getRoomByName(gameObject, playerObject.roomName),
      sectionObject = room.getSectionByName(roomObject, playerObject.sectionName),
      targetSectionName = action.substring(<span class="number">4</span>).toLowerCase(), <span class="comment">// remove '!GO_'</span>
      targetSectionObject = room.getSectionByName(roomObject, targetSectionName);

  exitSection(playerObject, sectionObject);
  playerObject.sectionName = targetSectionName;
  enterSection(playerObject, targetSectionObject);

};
module.exports.moveToSection = moveToSection;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h1>moveToRoom(playerObject, commandObject)</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> moveToRoom = <span class="function"><span class="keyword">function</span> <span class="params">(playerObject, commandObject)</span> {</span>
    <span class="keyword">var</span> gameObject = playerObject.game,
      roomObject = game.getRoomByName(gameObject, playerObject.roomName),
      sectionObject = room.getSectionByName(roomObject, playerObject.sectionName),
      targetRoomName = commandObject.parameters.nextRoomName,
      targetRoomObject = game.getRoomByName(gameObject, targetRoomName),
      targetSectionName = roomObject.spawnSection,
      targetSectionObject = room.getSectionByName(roomObject, targetSectionName),
      artFileURI = <span class="string">'./himins_txt/'</span> + roomObject.artFileName;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>TODO: refactor from game.start()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exitRoom(playerObject, roomObject);
  exitSection(playerObject, sectionObject);
  playerObject.roomName = targetRoomName;
  playerObject.sectionName = targetSectionName;

  files.loadTEXT(artFileURI, <span class="function"><span class="keyword">function</span> <span class="params">(resultObject)</span> {</span>
    playerObject.client.write(resultObject + <span class="string">'\n'</span>);

    enterRoom(playerObject, targetRoomObject);
    enterSection(playerObject, targetSectionObject);
  });

};
module.exports.moveToRoom = moveToRoom;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
