<!DOCTYPE html>

<html>
<head>
  <title>himins_format.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="himins_app.html">
                himins_app.js
              </a>
            
              
              <a class="source" href="himins_commands.html">
                himins_commands.js
              </a>
            
              
              <a class="source" href="himins_file_utils.html">
                himins_file_utils.js
              </a>
            
              
              <a class="source" href="himins_format.html">
                himins_format.js
              </a>
            
              
              <a class="source" href="himins_game.html">
                himins_game.js
              </a>
            
              
              <a class="source" href="himins_player.html">
                himins_player.js
              </a>
            
              
              <a class="source" href="himins_repl.html">
                himins_repl.js
              </a>
            
              
              <a class="source" href="himins_room.html">
                himins_room.js
              </a>
            
              
              <a class="source" href="himins_string_utils.html">
                himins_string_utils.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>himins_format.js</h1>
<p>formats text and resolves functions for display.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*jslint browser: false, continue: true, devel: true, indent: 2, maxerr: 50, newcap : true, nomen: true, plusplus: true, regexp: true, sloppy: true, vars: false, white: true
*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>includes</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>3rd party modules</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _ = require(<span class="string">'underscore'</span>),
  linewrap = require(<span class="string">'linewrap'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>Himins modules</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  room = require(<span class="string">'./himins_room.js'</span>),
  commands = require(<span class="string">'./himins_commands.js'</span>),
  game = require(<span class="string">'./himins_game.js'</span>),
  player = require(<span class="string">'./himins_player.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2>consts</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span>
  BOLD_RED_ESC = <span class="string">'\u001b[1;31m'</span>,
  BOLD_GREEN_ESC = <span class="string">'\u001b[1;32m'</span>,
  UL_BLUE_ESC = <span class="string">'\u001b[4;34m'</span>,
  NORMAL_ESC = <span class="string">'\u001b[0m'</span>,
  NL = <span class="string">'\n'</span>;

<span class="keyword">var</span> renderFormatCodes = <span class="function"><span class="keyword">function</span> <span class="params">(text)</span> {</span>
  <span class="keyword">var</span> result = text;

  result = result.replace(<span class="regexp">/^_/g</span>, <span class="string">' '</span> + BOLD_RED_ESC); <span class="comment">// match _ at SOL</span>
  result = result.replace(<span class="regexp">/ _/g</span>, <span class="string">' '</span> + BOLD_RED_ESC);
  result = result.replace(<span class="regexp">/_ /g</span>, NORMAL_ESC + <span class="string">' '</span>);
  result = result.replace(<span class="regexp">/_,/g</span>, NORMAL_ESC + <span class="string">','</span>);
  result = result.replace(<span class="regexp">/_\./g</span>, NORMAL_ESC + <span class="string">'.'</span>);
  result = result.replace(<span class="regexp">/_;/g</span>, NORMAL_ESC + <span class="string">';'</span>);
  result = result.replace(<span class="regexp">/_:/g</span>, NORMAL_ESC + <span class="string">':'</span>);
  result = result.replace(<span class="regexp">/_-/g</span>, NORMAL_ESC + <span class="string">'-'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>result = result.replace(/_\?/g, NORMAL_ESC + &#39;?&#39;);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  result = result.replace(<span class="regexp">/_$/g</span>, NORMAL_ESC); <span class="comment">// match _ at EOL</span>

  result = result.replace(<span class="regexp">/^\*/g</span>, <span class="string">' '</span> + BOLD_GREEN_ESC); <span class="comment">// match * at SOL</span>
  result = result.replace(<span class="regexp">/ \*/g</span>, <span class="string">' '</span> + BOLD_GREEN_ESC);
  result = result.replace(<span class="regexp">/\* /g</span>, NORMAL_ESC + <span class="string">' '</span>);
  result = result.replace(<span class="regexp">/\*,/g</span>, NORMAL_ESC + <span class="string">','</span>);
  result = result.replace(<span class="regexp">/\*\./g</span>, NORMAL_ESC + <span class="string">'.'</span>);
  result = result.replace(<span class="regexp">/\*;/g</span>, NORMAL_ESC + <span class="string">';'</span>);
  result = result.replace(<span class="regexp">/\*:/g</span>, NORMAL_ESC + <span class="string">':'</span>);
  result = result.replace(<span class="regexp">/\*-/g</span>, NORMAL_ESC + <span class="string">'-'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>result = result.replace(/*\?/g, NORMAL_ESC + &#39;?&#39;);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  result = result.replace(<span class="regexp">/\*$/g</span>, NORMAL_ESC); <span class="comment">// match * at EOL</span>

  <span class="keyword">return</span> result;
};

<span class="keyword">var</span> resolveFunctions = <span class="function"><span class="keyword">function</span> <span class="params">(client, text)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>console.log(&#39;<em>*</em> himins_format.js resolveFunctions(%s)&#39;, text);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span>
    result = text,
    playerObject = client.player,
    gameObject = playerObject.game,
    roomObject = game.getRoomByName(gameObject, playerObject.roomName),
    sectionObject = {};

  result = result.replace(<span class="regexp">/!GAME_NAME/g</span>, client.player.game.name);
  result = result.replace(<span class="regexp">/!PLAYER_NAME/g</span>, client.player.name);
  result = result.replace(<span class="regexp">/!COMMAND_NAMES/g</span>, commands.getCommandNames(playerObject.commands));
  result = result.replace(<span class="regexp">/!PLAYER_INVENTORY/g</span>, player.getInventoryNames(playerObject));
  result = result.replace(<span class="regexp">/!PLAYER_LOCATION/g</span>, playerObject.sectionName);
  result = result.replace(<span class="regexp">/!ROOM_NAME/g</span>, playerObject.roomName);
  result = result.replace(<span class="regexp">/!PLAYER_HEALTH/g</span>, playerObject.health);
  result = result.replace(<span class="regexp">/!MOVING_VERB/g</span>, _.sample(gameObject.movementVerbs));
  result = result.replace(<span class="regexp">/!MOVING_ADVERB/g</span>, _.sample(gameObject.movementAdverbs));
  result = result.replace(<span class="regexp">/!GAME_ATMOSPHERE/g</span>, _.sample(gameObject.atmosphereAdjectives));

  <span class="keyword">if</span> (roomObject) {
    sectionObject = room.getSectionByName(roomObject, playerObject.sectionName);
    result = result.replace(<span class="regexp">/!ROOM_DESCRIPTION/g</span>, roomObject.description);   
  }

  <span class="keyword">if</span> (sectionObject) {
    result = result.replace(<span class="regexp">/!SECTION_DESCRIPTION/g</span>, sectionObject.description);
  }
  <span class="keyword">return</span> result;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h1>formatText(client, text, indent, columnWidth)</h1>
<p>Transforms text (with basic markdown syntax into ASCII TTY) 
and wraps it to fit column specified by columnWidth.
Words that start with an exclamation point (!WORD) are treated as function identifiers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> formatText = <span class="function"><span class="keyword">function</span> <span class="params">(client, text, indent, columnWidth)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>console.log(&#39;<em>*</em> himins_format.js formatText(%s, %s, %d, %d)&#39;, client.name, text, indent, columnWidth);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  <span class="keyword">var</span>
    result = text,
    wrap = linewrap(indent, columnWidth, {skipScheme: <span class="string">'ansi-color'</span>});

  result = resolveFunctions(client, text);
  result = renderFormatCodes(result);
  result = wrap(result);
  <span class="keyword">return</span> result;
};
module.exports.formatText = formatText;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
